# คู่มือการใช้งานระบบลงทะเบียนกรรมการคุมสอบ (SPA)

## 1. ภาพรวมระบบ
- ระบบเป็น Single Page Application (SPA) พัฒนาด้วย React 18 + Vite
- รองรับ Node.js 18.19.1 และใช้งาน Tailwind CSS, ไลบรารี `lucide-react`
- เชื่อมต่อกับบริการภายนอกของมหาวิทยาลัยสำหรับยืนยันตัวตน (API `login_api.php`)
- จัดเก็บข้อมูลลงทะเบียนผ่าน REST API (`submit-api/api/`)
- มีระบบผู้ใช้งาน 2 กลุ่ม:
  - ผู้ใช้ทั่วไป (บุคลากร/อาจารย์)
  - ผู้ดูแลระบบ (Admin) สำหรับดูสถิติและรายชื่อ
- มีการจัดการเซสชันแบบ in-memory พร้อม timeout 10 นาที และเก็บสถานะหน้าจอด้วย `history.state`

## 2. ขั้นตอนใช้งานสำหรับผู้ใช้ทั่วไป

### 2.1 เข้าสู่ระบบ
1. เปิด URL ของระบบ (เช่น `https://example.com/proctor-reg-test`)
2. เมื่ออยู่ก่อนช่วงเปิดลงทะเบียน ระบบจะขึ้นข้อความนับถอยหลังและปิดการใช้งานฟอร์ม
3. กรณีช่วงเปิดลงทะเบียน:
   - ระบบแสดงจำนวนผู้ลงทะเบียนล่าสุด (อัปเดตทุก 10 วินาที)
   - ป้อนรหัสพนักงานและรหัสผ่าน จากนั้นกด “เข้าสู่ระบบ”
4. หากข้อมูลไม่ถูกต้อง ระบบจะแจ้งเตือนข้อผิดพลาดจาก API

### 2.2 ตรวจสอบคุณสมบัติ
- การเข้าสู่ระบบสำเร็จ ระบบจะเรียก API ตรวจสอบว่าผู้ใช้งานเคยลงทะเบียนแล้วหรือยัง
- ระบบตรวจสอบ `LEVEL_CODE` ต้องเป็นหนึ่งใน `{40,50,60,70,80,90}` หากไม่ผ่านจะแจ้ง “คุณสมบัติไม่ผ่านเกณฑ์”
- หากเคยลงทะเบียน ระบบจะแสดงหน้าสรุปข้อมูลพร้อมลำดับคิวทันที

### 2.3 ลงทะเบียน
1. ผู้ใช้ใหม่จะเห็นฟอร์มลงทะเบียนประกอบด้วย:
   - ข้อมูลส่วนตัว (แสดงแบบอ่านอย่างเดียว)
   - ข้อมูลติดต่อ (หมายเลขโทรศัพท์ต้องอย่างน้อย 9 หลัก)
   - การยืนยัน 2 ช่อง (“ยืนยันข้อมูลถูกต้อง” และ “ยินดีปฏิบัติหน้าที่…”)
   - ข้อมูลสวัสดิการ (ค่าตอบแทนรวม 1,240 บาท และรายละเอียดกิจกรรม)
2. เมื่อกรอกครบและติ๊กถูกทั้งสองเงื่อนไข ปุ่ม “ลงทะเบียนกรรมการคุมสอบ” จะกดได้
3. ระบบจะสร้าง timestamp (Unix ms, ISO 8601) และ sequence number สำหรับจัดลำดับคิว
4. หากลงทะเบียนซ้ำ ระบบจะแจ้งและโหลดข้อมูลเดิมกลับมาแสดง

### 2.4 หลังลงทะเบียน
- ระบบแสดงหน้าสรุป (Success Page)
  - แสดงลำดับคิว, รหัสลงทะเบียน, เวลา, เบอร์โทร, ประเภทบุคลากร, หน่วยงาน, เพศ ฯลฯ
  - แสดงข้อมูลสวัสดิการ (ประชุม + ปฏิบัติหน้าที่)
  - ปุ่ม “ออกจากระบบ” สำหรับจบการใช้งาน

## 3. ขั้นตอนสำหรับผู้ดูแลระบบ (Admin)

### 3.1 เข้าสู่ระบบ
- ใช้ขั้นตอนเดียวกับผู้ใช้ทั่วไป แต่เมื่อ API ระบุ `USER_ROLE = admin` หรือ `EMP_CODE` อยู่ในรายชื่อ admin (`140014`, `653004`) ระบบจะแสดงเมนูเพิ่มเติม

### 3.2 แถบ “ข้อมูลของฉัน”
- เหมือนหน้าลงทะเบียนของผู้ใช้ทั่วไป (ตรวจสอบ-ลงทะเบียน)
- สามารถดูข้อมูลการลงทะเบียนของตัวเองหรือแก้ไขหมายเลขโทรศัพท์

### 3.3 แถบ “แดชบอร์ดผู้ดูแล”
- แสดงสถิติภาพรวม:
  - จำนวนลงทะเบียนทั้งหมด + เวลาปิดลงทะเบียนพร้อมนับถอยหลัง (อัปเดตทุกวินาที)
  - รายการ top หน่วยงาน/ระดับ/บทบาท/เพศ
  - ตารางรายชื่อผู้ลงทะเบียน แสดงคอลัมน์ ลำดับ, รหัสพนักงาน, คิว, ชื่อเต็ม, ระดับ, สังกัด, โทรศัพท์
    - มีค้นหา, แบ่งหน้า (20 รายการต่อหน้า), ปุ่มส่งออก Excel (`xlsx` + `file-saver`)
  - กราฟจำนวนผู้ลงทะเบียนรายวัน (7–12 พ.ย. 2568)
  - กราฟสัดส่วนประเภทบุคลากร (อาจารย์ vs บุคลากร)
  - กราฟสัดส่วนเพศ (ชาย/หญิง)
- ปุ่ม “รีเฟรชข้อมูล” จะเรียก API ใหม่ทันที

## 4. การจัดการช่วงเวลาเปิด-ปิดระบบ

- ตาราง `exam_proctor_windows` ใช้กำหนดเวลาเปิด (`opens_at`) และปิด (`closes_at`) ลงทะเบียน
- API `action=window` จะส่งค่าเปิด-ปิดพร้อม timestamp ให้ฝั่ง frontend ใช้คำนวณนับถอยหลัง
- Backend ตรวจสอบช่วงเวลาอีกขั้นตอนก่อนยอมให้ลงทะเบียน (หากยังไม่เปิดหรือปิดแล้วจะตอบ 423)
- ระบบ frontend ดึงข้อมูลช่วงเวลาใหม่ทุก 5 นาที (def) และอัปเดต Banner/สถานะอัตโนมัติ

## 5. ค่าตอบแทนและกิจกรรม (ข้อมูลที่แสดงบน UI)

| รายการ | รายละเอียด |
|--------|-------------|
| เบี้ยเลี้ยงรวม | 1,240 บาท / คน |
| ประชุมเตรียมความพร้อม | 4 ธ.ค. 2568 เวลา 09:00 น. ณ ห้องประชุมหมื่นจง · เบี้ยเลี้ยง 200 บาท |
| ปฏิบัติหน้าที่คุมสอบ | 7 ธ.ค. 2568 เวลา 07:00–16:00 น. · เบี้ยเลี้ยง 1,000 บาท + ค่าเครื่องดื่ม 40 บาท |
| หมายเหตุ | ผู้คุมสอบดูแลตนเอง ไม่มีเบรกและอาหารเพิ่มเติม |

## 6. ฝั่ง Backend (PHP 5.6 + MySQL)

- ไฟล์หลัก: `backend/api/index.php`
- ฟังก์ชันเด่น:
  - `action=login`: เรียก API ภายนอกและตรวจสอบสิทธิ์
  - `action=register`: บันทึกข้อมูล พร้อมตรวจสอบเวลาและป้องกันลงทะเบียนซ้ำ
  - `action=list`: รายชื่อผู้ลงทะเบียน (เฉพาะ admin)
  - `action=stats`: สถิติสำหรับแดชบอร์ด (เฉพาะ admin)
  - `action=detail`: รายละเอียดผู้ใช้รายบุคคล
  - `action=public_total`: จำนวนผู้ลงทะเบียนรวม (ใช้แสดงบนหน้า login)
- ตารางสำคัญ:
  - `exam_proctor_registrations` — เก็บข้อมูลลงทะเบียน (emp_code, phone_number, timestamps, queue, user_type, user_role ฯลฯ)
  - `exam_proctor_windows` — เก็บช่วงเวลาเปิด/ปิดระบบ

## 7. ข้อควรระวังและการปรับแต่ง

- หาก API ภายนอกเปลี่ยนรูปแบบ ให้ปรับ `src/services/api.js` ให้สอดคล้อง
- หากเพิ่ม admin คนใหม่ ให้ปรับรายการ `admin_emp_codes` ใน backend หรือส่ง `USER_ROLE=admin`
- ระวังการตั้งค่าเวลาเปิด-ปิด: ใช้รูปแบบ `YYYY-MM-DD HH:mm:ss` (เวลาท้องถิ่นที่ตั้งค่า timezone ไว้)
- หลัง deploy ควรทดสอบการนับถอยหลังและการ refresh ยอดรวมว่าทำงานตรงกับเวลาจริง

## 8. การพัฒนาและคำสั่งที่ใช้บ่อย

```bash
# ติดตั้ง dependency
npm install

# รันระบบสำหรับพัฒนา
npm run dev

# ตรวจสอบ lint
npm run lint

# สร้าง build สำหรับ production
npm run build

# สร้างไฟล์คู่มือ (ไฟล์นี้): docs/user-guide.md
```

สำหรับการอัปโหลดไฟล์ backend ให้คัดลอกโฟลเดอร์ `backend/` ขึ้นเซิร์ฟเวอร์ PHP 5.6 และตั้งค่า database ให้สอดคล้องกับ `$config` ใน `backend/api/index.php` รวมถึงนำสคริปต์ SQL ใน `backend/schema/` ไปสร้างตารางก่อนใช้งาน


